---

information:
  - "This node has both Plumbery and Apache Libcloud pre-installed."

parameters:

  locationId:
    information:
      - "the target data centre for this deployment"
    type: locations.list
    default: NA12

  domainName:
    information:
      - "the name of the network domain to be deployed"
    type: str
    default: BeachheadFox

  networkName:
    information:
      - "the name of the Ethernet VLAN to be deployed"
    type: str
    default: BeachheadNetwork

  nodeName:
    information:
      - "the name of the main node to be deployed"
    type: str
    default: apache01

links:
  documentation: https://plumbery.readthedocs.org/en/latest/tutorial.beachhead.html

---
locationId: {{ locationId.parameter }}

blueprints:

  - beachhead:

      domain:
        name: {{ domainName.parameter }}
        ipv4: 2

      ethernet:
        name: {{ networkName.parameter }}
        subnet: 10.0.0.0

      nodes:

        - {{ nodeName.parameter }}:

            description: '#beachhead #ops'

            glue:
              - internet 22

            running: always
            monitoring: essentials

            cloud-config:

              disable_root: false
              ssh_pwauth: True

              packages:
                - python-pip
                - python-dev
                - git

              runcmd:
                - pip install -e git+https://github.com/apache/libcloud.git#egg=apache-libcloud
                - pip install -e git+https://github.com/bernard357/plumbery.git#egg=plumbery